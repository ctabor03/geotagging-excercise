<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Villamonte Geotagging Activity</title>

  <!-- Leaflet Core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Fullscreen Plugin -->
  <link
    rel="stylesheet"
    href="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css"
  />
  <script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"></script>

  <style>
    /* ==================== GLOBAL MOBILE-FRIENDLY RESET ==================== */
    html, body {
      margin: 0;
      padding: 0;
      background: #f2f2f2;
      font-family: Arial, sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      padding-bottom: env(safe-area-inset-bottom);
    }

    h3 {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }

    /* ==================== CARD BOXES ==================== */
    .box {
      padding: 16px;
      margin: 12px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    /* ==================== INPUTS + BUTTONS ==================== */
    input, button {
      width: 100%;
      padding: 14px 16px;
      margin-top: 12px;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #cfcfcf;
      box-sizing: border-box;
    }

    input {
      background: #fafafa;
    }

    button {
      background: #007bff;
      color: white;
      font-weight: bold;
      border: none;
      transition: 0.15s ease;
    }

    button:active {
      background: #005fcc;
      transform: scale(0.97);
    }

    /* ==================== MAP AREA ==================== */
    #map {
      width: 100%;
      height: 55vh;
      border-radius: 10px;
      margin: 12px 0;
      overflow: hidden;
    }

    /* ==================== PERMANENT LABEL STYLE ==================== */
    .pin-label {
      background: rgba(255,255,255,0.95);
      color: #000;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: bold;
      border: 1px solid #333;
      box-shadow: 0 1px 4px rgba(0,0,0,0.4);
      white-space: nowrap;
    }

    /* ==================== MOBILE RESPONSIVE TUNING ==================== */
    @media (max-width: 430px) {
      h3 { font-size: 1.1rem; }
      input, button { font-size: 0.95rem; padding: 12px; }
      #map { height: 60vh; }
    }

    @media (max-width: 360px) {
      h3 { font-size: 1rem; }
      input, button { font-size: 0.85rem; padding: 10px; }
      .box { padding: 12px; margin: 8px; }
    }

    /* ==================== FULLSCREEN BUTTON STYLING ==================== */
    .leaflet-control-fullscreen-button {
      background: white !important;
      border-radius: 8px !important;
      width: 36px !important;
      height: 36px !important;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25) !important;
      border: none !important;
    }

    .leaflet-container:fullscreen {
      width: 100vw !important;
      height: 100vh !important;
    }
  </style>
</head>

<body>

<!-- ==================== TOP CARD ==================== -->
<div class="box">
  <h3>Barangay Villamonte</h3>
  <button onclick="enablePinMode()">âž• Add Pin</button>
  <input id="placeName" placeholder="Name of the place" />
  <input id="placeAddress" placeholder="Address of the place" />
</div>

<!-- ==================== MAP ==================== -->
<div id="map"></div>

<!-- ==================== BOTTOM CARD ==================== -->
<div class="box">
  <button onclick="submitLocation()">ðŸ“Œ Submit Last Pin</button>
  <div id="result"></div>
</div>

<!-- ==================== JAVASCRIPT ==================== -->
<script>
  /* ==================== INIT MAP ==================== */
  const map = L.map("map", {
    zoomControl: true,
    fullscreenControl: true,         // FULLSCREEN ENABLED
    fullscreenControlOptions: {
      position: 'topright'
    },
    maxBoundsViscosity: 1.0
  }).setView([10.6685, 122.9647], 15);

  /* Satellite Layer */
  L.tileLayer(
    "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
    { maxZoom: 19 }
  ).addTo(map);

  /* ==================== VILLAMONTE BOUNDARY ==================== */
  const villamonteCoords = [
    [10.6760,122.9530],
    [10.6760,122.9770],
    [10.6590,122.9770],
    [10.6590,122.9530]
  ];

  const villamontePoly = L.polygon(villamonteCoords, {
    color: "#ff0000", weight: 2, fillOpacity: 0
  }).addTo(map);

  map.fitBounds(villamontePoly.getBounds());
  map.setMaxBounds(villamontePoly.getBounds());

  /* ==================== DARK MASK OUTSIDE ==================== */
  const world = [
    [-90, -180], [-90, 180], [90, 180], [90, -180]
  ];

  L.polygon([world, villamonteCoords], {
    color: "#000",
    fillOpacity: 0.60,
    stroke: false
  }).addTo(map);

  /* ==================== PERMANENT STI WEST NEGROS UNIVERSITY PIN ==================== */
  const stiLat = 10.669309973518835;
  const stiLng = 122.95691342250888;

  const permanentMarker = L.marker([stiLat, stiLng], { draggable: false }).addTo(map);

  permanentMarker.bindTooltip(
    "<b>STI West Negros University</b>",
    { permanent: true, direction: "top", offset: [0,-10], className: "pin-label" }
  );

  /* ==================== USER PINS ==================== */
  let userPins = [];
  let pinMode = false;

  function enablePinMode() {
    pinMode = true;
    alert("Tap inside Barangay Villamonte to place a pin.");
  }

  map.on("click", function(e) {
    if (!pinMode) return;

    if (!villamontePoly.getBounds().contains(e.latlng)) {
      alert("Please tap inside Villamonte.");
      return;
    }

    const pin = L.marker(e.latlng, { draggable: false }).addTo(map);
    userPins.push(pin);

    pinMode = false;
  });

  /* ==================== SUBMIT BUTTON â€” LABEL PIN ==================== */
  function submitLocation() {
    const name = document.getElementById("placeName").value.trim();
    const address = document.getElementById("placeAddress").value.trim();

    if (userPins.length === 0) {
      alert("Place at least one pin first.");
      return;
    }
    if (!name) {
      alert("Enter the name of the place.");
      return;
    }

    const lastPin = userPins[userPins.length - 1];
    const pos = lastPin.getLatLng();

    /* Add readable label */
    lastPin.bindTooltip(
      `<b>${name}</b>`,
      {
        permanent: true,
        direction: "top",
        offset: [0,-10],
        className: "pin-label"
      }
    ).openTooltip();

    document.getElementById("result").innerHTML = `
      <b>Label Added:</b><br>
      <b>${name}</b><br>
      Latitude: ${pos.lat.toFixed(6)}<br>
      Longitude: ${pos.lng.toFixed(6)}<br>
    `;

    document.getElementById("placeName").value = "";
    document.getElementById("placeAddress").value = "";
  }
</script>

</body>
</html>
