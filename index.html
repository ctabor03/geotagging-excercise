<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Villamonte Geotagging Activity</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    /* ==================== GLOBAL ==================== */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      -webkit-tap-highlight-color: transparent;
    }

    h3 {
      font-size: 1.2rem;
    }

    /* ==================== BOX / CARD ==================== */
    .box {
      padding: 5vw;
      background: white;
      margin: 3vw;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* ==================== FORM ELEMENTS ==================== */
    input, button {
      width: 100%;
      padding: 14px 16px;
      margin-top: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      background: #006eff;
      color: white;
      border: none;
      font-weight: bold;
    }

    button:active {
      background: #0050c1;
      transform: scale(0.98);
    }

    /* ==================== MAP AREA ==================== */
    #map {
      width: 100%;
      height: 55vh;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    /* ==================== LABEL STYLE ==================== */
    .pin-label {
      background: rgba(255,255,255,0.95);
      color: #000;
      padding: 3px 6px;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: bold;
      border: 1px solid #333;
    }

    @media (max-width: 400px) {
      h3 { font-size: 1rem; }
      input, button { font-size: 0.9rem; padding: 12px; }
      #map { height: 60vh; }
    }
  </style>
</head>

<body>

<!-- ==================== TOP CARD ==================== -->
<div class="box">
  <h3>Barangay Villamonte</h3>

  <button onclick="enablePinMode()">âž• Add Pin</button>

  <input id="placeName" placeholder="Name of the place" />
  <input id="placeAddress" placeholder="Address of the place" />
</div>

<!-- ==================== MAP ==================== -->
<div id="map"></div>

<!-- ==================== BOTTOM CARD ==================== -->
<div class="box">
  <button onclick="submitLocation()">ðŸ“Œ Submit Last Pin</button>
  <div id="result"></div>
</div>

<!-- ==================== JAVASCRIPT ==================== -->
<script>
  /* ==================== INIT MAP ==================== */
  const map = L.map("map", {
    zoomControl: true,
    maxBoundsViscosity: 1.0
  }).setView([10.6685, 122.9647], 15);

  /* Satellite Layer */
  L.tileLayer(
    "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
    { maxZoom: 19 }
  ).addTo(map);

  /* ==================== VILLAMONTE BOUNDARY ==================== */
  const villamonteCoords = [
    [10.6760,122.9530],
    [10.6760,122.9770],
    [10.6590,122.9770],
    [10.6590,122.9530]
  ];

  const villamontePoly = L.polygon(villamonteCoords, {
    color: "#ff0000", weight: 2, fillOpacity: 0
  }).addTo(map);

  map.fitBounds(villamontePoly.getBounds());
  map.setMaxBounds(villamontePoly.getBounds());

  /* ==================== DARK MASK OUTSIDE ==================== */
  const world = [
    [-90, -180], [-90, 180], [90, 180], [90, -180]
  ];

  L.polygon([world, villamonteCoords], {
    color: "#000",
    fillOpacity: 0.60,
    stroke: false
  }).addTo(map);

  /* ==================== PERMANENT STI WEST NEGROS UNIVERSITY PIN ==================== */
  const stiLat = 10.669309973518835;
  const stiLng = 122.95691342250888;

  const permanentMarker = L.marker([stiLat, stiLng], { draggable: false }).addTo(map);

  permanentMarker.bindTooltip(
    "<b>STI West Negros University</b>",
    { permanent: true, direction: "top", offset: [0,-10], className: "pin-label" }
  );

  /* ==================== USER PINS ==================== */
  let userPins = [];
  let pinMode = false;

  function enablePinMode() {
    pinMode = true;
    alert("Tap inside Barangay Villamonte to place a pin.");
  }

  map.on("click", function(e) {
    if (!pinMode) return;

    if (!villamontePoly.getBounds().contains(e.latlng)) {
      alert("Please tap inside Villamonte.");
      return;
    }

    const pin = L.marker(e.latlng, { draggable: false }).addTo(map);
    userPins.push(pin);

    pinMode = false;
  });

  /* ==================== SUBMIT BUTTON â€” LABEL PIN ==================== */
  function submitLocation() {
    const name = document.getElementById("placeName").value.trim();
    const address = document.getElementById("placeAddress").value.trim();

    if (userPins.length === 0) {
      alert("Place at least one pin first.");
      return;
    }
    if (!name) {
      alert("Enter the name of the place.");
      return;
    }

    const lastPin = userPins[userPins.length - 1];
    const pos = lastPin.getLatLng();

    /* Add readable permanent label */
    lastPin.bindTooltip(
      `<b>${name}</b>`,
      {
        permanent: true,
        direction: "top",
        offset: [0, -10],
        className: "pin-label"
      }
    ).openTooltip();

    document.getElementById("result").innerHTML = `
      <b>Label Added:</b><br>
      <b>${name}</b><br>
      <b>Latitude:</b> ${pos.lat.toFixed(6)}<br>
      <b>Longitude:</b> ${pos.lng.toFixed(6)}<br>
      Label is now visible on the map.
    `;

    document.getElementById("placeName").value = "";
    document.getElementById("placeAddress").value = "";
  }
</script>

</body>
</html>
